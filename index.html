<html>
<head>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <h1>Calculator</h1>
    <div class="formstyle" x-data="
        {
            numbers:
                [ 0, 1, 2, 3, 4, 5, 6, 7, 8, 9
            ],
            evaluationDone: false,
            history: [],
            newValue: '',
            clearInputBoxOnAnswer: '',
            squareRoot: '',
            calculation: '',
            operators: ['+','-','*','/'],
            x2: '',
            answer: ''
        }">

        <template x-for="showHistory in history">
            <p x-text="showHistory"></p><br>
        </template>
        <form name="form" @submit.prevent>
            <input id="calc" type="text" name="answer" x-model="answer"
                @keyup="
                    clearInputBoxOnAnswer = clearInputBoxOnKeyUp(answer, evaluationDone, operators, newValue);
                    answer = clearInputBoxOnAnswer.answer;
                    evaluationDone = clearInputBoxOnAnswer.evaluationDone;
                "
                @keyup.enter="
                    calculation = calculationOperations(answer, squareRoot,history, evaluationDone, x2);
                    history = calculation.history;
                    answer = calculation.answer;
                    evaluationDone = calculation.evaluationDone;
                    "
                >
            <template x-for="number in numbers">
                <input type="button" :value="number" x-text="number"
                    @click="calculation = checkAndClearAnswer(evaluationDone, answer, number);
                        evaluationDone = calculation.evaluationDone;
                        answer = calculation.answer;
                    "
                >
            </template>

            <input type="button" id="clear" value="Clear All"
                @click="
                    if(answer != '') {
                        history = [];
                    }
                    answer = ''; "
            >
            <input type="button" value="." @click="answer +='.';  evaluationDone=false">
            <input type="button" value="+" @click="answer += '+'; evaluationDone=false">
            <input type="button" value="-" @click="answer += '-'; evaluationDone=false">
            <input type="button" value="*" @click="answer += '*'; evaluationDone=false">
            <input type="button" value="/" @click="answer += '/'; evaluationDone=false">
            <input type="button" value="x2" @click="answer += 'x'; evaluationDone=false">
            <input type="button" value="&radic;" @click="answer += '&radic;'; evaluationDone=false">


            <input type="button" value="="
                @click="
                    calculation = calculationOperations(answer, squareRoot,history, evaluationDone, x2);
                    history = calculation.history;
                    answer = calculation.answer;
                    evaluationDone = calculation.evaluationDone;
                "
            >
        </form>

        <script>
            function clearInputBoxOnKeyUp(answer, evaluationDone, operators, newValue) {
                if (evaluationDone && answer != '') {
                    newValue = answer.charAt(answer.length - 1);
                    for (i = 0; i < operators.length; i++) {
                        if (operators[i] == newValue) {
                            evaluationDone = false;
                        }
                    }
                    if (evaluationDone) {
                        answer = '';
                        evaluationDone = false;
                        answer += newValue;
                    }
                }
                return {
                    'evaluationDone': evaluationDone,
                    'answer': answer,
                }
            }

            function calculationOperations(answer, squareRoot, history, evaluationDone, x2) {
                if (answer.charAt(answer.length - 1) == 'x') {
                    x2 = answer.substring(0, answer.length - 1);
                    history.push(x2 + '*' + x2 + '=' + x2 * x2);
                    x2 = x2 * x2;
                    answer = '' + x2;
                    evaluationDone = true;
                }
                else if (answer.charAt(0) == '&radic;') {
                    squareRoot = answer.substring(1);
                    squareRoot = Math.sqrt(squareRoot);
                    history.push(answer + '=' + squareRoot);
                    answer = squareRoot;
                }
                else {
                    inputValue = document.getElementById('calc').value;
                    answer = inputValue;
                    answer = eval(answer);
                    history.push(inputValue + '=' + eval(answer));
                    evaluationDone = true;
                }

                return {
                    'squareRoot': squareRoot,
                    'answer': answer,
                    'history': history,
                    'evaluationDone': evaluationDone,
                }
            }


            function checkAndClearAnswer(evaluationDone, answer, number) {
                if (evaluationDone && answer != '') {
                    answer = '';
                }
                answer += number;
                evaluationDone = false;

                return {
                    'evaluationDone': evaluationDone,
                    'answer': answer,
                    'number': number,
                }
            }
        </script>
</body>
</html>